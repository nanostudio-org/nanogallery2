/* nanogallery2 - v2.0.0 - 2017-11-30 - http://nanogallery2.nanostudio.org */
/**!
 * @preserve nanogallery2 - GOOGLE PHOTOS data provider
 * Homepage: http://nanogallery2.nanostudio.org
 * Sources:  https://github.com/nanostudio-org/nanogallery2
 *
 * License:  GPLv3 and commercial licence
 * 
*/
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","nanogallery2"],a):a("object"==typeof exports&&"function"==typeof require?require(["jquery","nanogallery2"]):jQuery)}(function(a){jQuery.nanogallery2.data_google2=function(a,b){function c(a,b,c){h.O.debugMode&&(console.log("Google Photos data:"),console.dir(c));var d=h.I[a].GetID();""==h.I[a].title&&(h.I[a].title=c.feed.title.$t),jQuery.each(c.feed.entry,function(a,c){var f=c.media$group.media$content[0].url,g=c.title.$t,i="",j=c.media$group.media$description.$t;"image"==b&&(i=g,""!=j&&(g=j,j=""),""!=h.O.thumbnailLabel.get("title")&&(g=m(unescape(unescape(unescape(unescape(f)))))));var k=c.gphoto$id.$t;if("album"!=b||n(g,k)){var l=NGY2Item.New(h,g,j,k,d,b,""),o="";if("image"==b){if(o=f,!h.O.viewerZoom&&void 0!=h.O.viewerZoom){var p=f.substring(0,f.lastIndexOf("/"));p=p.substring(0,p.lastIndexOf("/"))+"/",o=window.screen.width>window.screen.height?p+"w"+window.screen.width+"/"+i:p+"h"+window.screen.height+"/"+i}l.setMediaURL(o,"img"),void 0!==c.gphoto$width&&(l.imageWidth=parseInt(c.gphoto$width.$t)),void 0!==c.gphoto$height&&(l.imageHeight=parseInt(c.gphoto$height.$t)),null!=c.media$group&&null!=c.media$group.media$credit&&c.media$group.media$credit.length>0&&(l.author=c.media$group.media$credit[0].$t),void 0!==c.exif$tags&&(void 0!=c.exif$tags.exif$exposure&&(l.exif.exposure=c.exif$tags.exif$exposure.$t),void 0!=c.exif$tags.exif$flash&&"true"==c.exif$tags.exif$flash.$t&&(l.exif.flash="flash"),void 0!=c.exif$tags.exif$focallength&&(l.exif.focallength=c.exif$tags.exif$focallength.$t),void 0!=c.exif$tags.exif$fstop&&(l.exif.fstop=c.exif$tags.exif$fstop.$t),void 0!=c.exif$tags.exif$iso&&(l.exif.iso=c.exif$tags.exif$iso.$t),void 0!=c.exif$tags.exif$model&&(l.exif.model=c.exif$tags.exif$model.$t),void 0!=c.gphoto$location&&(l.exif.location=c.gphoto$location))}else l.author=c.author[0].name.$t,l.numberItems=c.gphoto$numphotos.$t;l.thumbs=e("l1",0,l.thumbs,c,b),l.thumbs=e("lN",5,l.thumbs,c,b);var q=h.O.fnProcessData;null!==q&&("function"==typeof q?q(l,"google2",c):window[q](l,"google2",c))}}),h.I[a].contentIsLoaded=!0}function d(a,b){jQuery(document).queue("GoogleAlbumWithAuthkey",function(){var c=a.indexOf("&authkey=");-1==c&&(c=a.indexOf("?authkey="));var d=a.substring(0,c),f=a.substring(c);-1==f.indexOf("Gv1sRg")&&(f="&authkey=Gv1sRg"+f.substring(9));var g=Google.url()+"user/"+h.O.userID+"/albumid/"+d+"?alt=json&kind=photo"+f+"&max-results=1&thumbsize="+h.picasa.thumbSizes+"&imgmax=d";k(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var i=setTimeout(function(){k(!1),l(h,"Could not retrieve AJAX data...")},6e4);jQuery.getJSON(g,function(a,c,g){clearTimeout(i),k(!1);var j=a.feed.title.$t,l=a.feed.entry[0],m=NGY2Item.New(h,j,"",d,"0","album","");m.authkey=f,m.thumbs=e("l1",0,m.thumbs,l,"album"),m.thumbs=e("lN",5,m.thumbs,l,"album"),"function"==typeof h.O.fnProcessData&&h.O.fnProcessData(m,"google",l),m.numberItems=a.feed.gphoto$numphotos.$t,jQuery(document).queue("GoogleAlbumWithAuthkey").length>0?jQuery(document).dequeue("GoogleAlbumWithAuthkey"):b()}).fail(function(a,b,c){clearTimeout(i),k(!1),l(h,"Could not retrieve ajax data (google): "+b+", "+c),jQuery(document).dequeue("GoogleAlbumWithAuthkey")})})}function e(a,b,c,d,e){for(var f=["xs","sm","me","la","xl"],g=0;g<f.length;g++)if(c.url[a][f[g]]=d.media$group.media$thumbnail[b+g].url,"image"==e){c.width[a][f[g]]=d.media$group.media$thumbnail[b+g].width,c.height[a][f[g]]=d.media$group.media$thumbnail[b+g].height;var i=d.media$group.media$thumbnail[b+g].width,j=d.media$group.media$thumbnail[b+g].height;if("auto"==h.tn.settings.width[a][f[g]]&&j<h.tn.settings.height[a][f[g]]){var k=i/j;c.width[a][f[g]]=i*k,c.height[a][f[g]]=j*k;var l=c.url[a][f[g]].substring(0,c.url[a][f[g]].lastIndexOf("/"));l=l.substring(0,l.lastIndexOf("/"))+"/",c.url[a][f[g]]=l+"h"+h.tn.settings.height[a][f[g]]+"/"}if("auto"==h.tn.settings.height[a][f[g]]&&i<h.tn.settings.width[a][f[g]]){var m=j/i;c.height[a][f[g]]=j*m,c.width[a][f[g]]=i*m;var l=c.url[a][f[g]].substring(0,c.url[a][f[g]].lastIndexOf("/"));l=l.substring(0,l.lastIndexOf("/"))+"/",c.url[a][f[g]]=l+"w"+h.tn.settings.width[a][f[g]]+"/"}}else{if("auto"!=h.tn.settings.width[a][f[g]]);else{var l=c.url[a][f[g]].substring(0,c.url[a][f[g]].lastIndexOf("/"));l=l.substring(0,l.lastIndexOf("/"))+"/",c.url[a][f[g]]=l+"h"+h.tn.settings.height[a][f[g]]+"/"}if("auto"!=h.tn.settings.height[a][f[g]]);else{var l=c.url[a][f[g]].substring(0,c.url[a][f[g]].lastIndexOf("/"));l=l.substring(0,l.lastIndexOf("/"))+"/",c.url[a][f[g]]=l+"w"+h.tn.settings.width[a][f[g]]+"/"}}return c}function f(){h.picasa={thumbSizes:""};var a=1;!0===h.tn.opt.l1.crop&&(a=h.O.thumbnailCropScaleFactor);var b=1;!0===h.tn.opt.lN.crop&&(b=h.O.thumbnailCropScaleFactor);var c=h.tn.settings;h.picasa.thumbSizes=g(h.picasa.thumbSizes,c.width.l1.xs*a*c.mosaic.l1Factor.w.xs,c.height.l1.xs*a*c.mosaic.l1Factor.h.xs,c.width.l1.xsc,c.height.l1.xsc),h.picasa.thumbSizes=g(h.picasa.thumbSizes,c.width.l1.sm*a*c.mosaic.l1Factor.w.sm,c.height.l1.sm*a*c.mosaic.l1Factor.h.sm,c.width.l1.smc,c.height.l1.smc),h.picasa.thumbSizes=g(h.picasa.thumbSizes,c.width.l1.me*a*c.mosaic.l1Factor.w.me,c.height.l1.me*a*c.mosaic.l1Factor.h.me,c.width.l1.mec,c.height.l1.mec),h.picasa.thumbSizes=g(h.picasa.thumbSizes,c.width.l1.la*a*c.mosaic.l1Factor.w.la,c.height.l1.la*a*c.mosaic.l1Factor.h.la,c.width.l1.lac,c.height.l1.lac),h.picasa.thumbSizes=g(h.picasa.thumbSizes,c.width.l1.xl*a*c.mosaic.l1Factor.w.xl,c.height.l1.xl*a*c.mosaic.l1Factor.h.xl,c.width.l1.xlc,c.height.l1.xlc),h.picasa.thumbSizes=g(h.picasa.thumbSizes,c.width.lN.xs*b*c.mosaic.lNFactor.w.xs,c.height.lN.xs*b*c.mosaic.lNFactor.h.xs,c.width.lN.xsc,c.height.lN.xsc),h.picasa.thumbSizes=g(h.picasa.thumbSizes,c.width.lN.sm*b*c.mosaic.lNFactor.w.sm,c.height.lN.sm*b*c.mosaic.lNFactor.h.sm,c.width.lN.smc,c.height.lN.smc),h.picasa.thumbSizes=g(h.picasa.thumbSizes,c.width.lN.me*b*c.mosaic.lNFactor.w.me,c.height.lN.me*b*c.mosaic.lNFactor.h.me,c.width.lN.mec,c.height.lN.mec),h.picasa.thumbSizes=g(h.picasa.thumbSizes,c.width.lN.la*b*c.mosaic.lNFactor.w.la,c.height.lN.la*b*c.mosaic.lNFactor.h.la,c.width.lN.lac,c.height.lN.lac),h.picasa.thumbSizes=g(h.picasa.thumbSizes,c.width.lN.xl*b*c.mosaic.lNFactor.w.xl,c.height.lN.xl*b*c.mosaic.lNFactor.h.xl,c.width.lN.xlc,c.height.lN.xlc)}function g(a,b,c,d,e){var f=Math.ceil(c*h.tn.scale)+e;return isNaN(b)?f=Math.ceil(c*h.tn.scale)+e:isNaN(c)?f=Math.ceil(b*h.tn.scale)+d:b>c&&(f=Math.ceil(b*h.tn.scale)+d),a.length>0&&(a+=","),a+=f}var h=a;Google={url:function(){return"https://photos.googleapis.com/data/feed/api/"},thumbSize:64,thumbAvailableSizes:new Array(32,48,64,72,94,104,110,128,144,150,160,200,220,288,320,400,512,576,640,720,800,912,1024,1152,1280,1440,1600),thumbAvailableSizesCropped:" 32 48 64 72 104 144 150 160 "};var i=function(a,b,d,e){var f=Google.url()+"user/"+h.O.userID,g="image",i=NGY2Item.GetIdx(h,a),j="";h.galleryMaxItems.Get()>0&&(j="&max-results="+h.galleryMaxItems.Get());var m="";if("undefined"!=typeof ngy2_pwa_at&&(m=ngy2_pwa_at),0==a)""!=m?f+="?alt=json&v=3&kind=album&thumbsize="+h.picasa.thumbSizes+j+"&rnd="+(new Date).getTime()+"&access_token="+m:void 0==h.O.google2URL||""==h.O.google2URL?f+="?alt=json&v=3&kind=album&thumbsize="+h.picasa.thumbSizes+j+"&rnd="+(new Date).getTime():f=h.O.google2URL+"?nguserid="+h.O.userID+"&alt=json&v=3&kind=album&thumbsize="+h.picasa.thumbSizes+j+"&rnd="+(new Date).getTime(),g="album";else{var n="";""!=h.I[i].authkey&&(n=h.I[i].authkey),""!=m?f+="/albumid/"+a+"?alt=json&kind=photo&thumbsize="+h.picasa.thumbSizes+j+n+"&imgmax=d&access_token="+m:void 0==h.O.google2URL||""==h.O.google2URL?f+="/albumid/"+a+"?alt=json&v=3&kind=photo&thumbsize="+h.picasa.thumbSizes+j+"&rnd="+(new Date).getTime():f=h.O.google2URL+"?nguserid="+h.O.userID+"&ngalbumid="+a+"&alt=json&v=3&kind=photo&thumbsize="+h.picasa.thumbSizes+j+n+"&imgmax=d"}h.O.debugMode&&console.log("Google Photos URL: "+f),k(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;try{var p=setTimeout(function(){k(!1),l("Could not retrieve AJAX data...")},6e4),q=function(f){clearTimeout(p),k(!1),c(i,g,f),o(a),null!==b&&void 0!==b&&b(d,e,null)},r=null,s=function(a,b){jQuery.getJSON(a+"&start-index="+b+"&callback=?",function(b){if("error"==b.nano_status)return clearTimeout(p),k(!1),void l(h,"Could not retrieve Google data. Error: "+b.nano_message);null===r?r=b:r.feed.entry=r.feed.entry.concat(b.feed.entry);var c=b.feed.openSearch$startIndex.$t+b.feed.openSearch$itemsPerPage.$t,d=0;d="image"==g?void 0===b.feed.gphoto$numphotos?b.feed.openSearch$totalResults.$t:b.feed.gphoto$numphotos.$t:b.feed.openSearch$totalResults.$t,c>=d||c>=h.galleryMaxItems.Get()?q(r):s(a,c)}).fail(function(b,c,d){clearTimeout(p),k(!1);var e="";for(var f in b)e+=f+"="+b[f]+"<br>";l(h,"Could not retrieve Google data. Error: "+c+", "+d+" "+e+"<br><br>URL:"+a)})};s(f,1)}catch(t){l(h,"Could not retrieve Google data. Error: "+t)}},j=function(a,b){for(var c=[].concat(a),e=0;e<c.length;e++)d(c[e],b);jQuery(document).dequeue("GoogleAlbumWithAuthkey")},k=NGY2Tools.PreloaderDisplay.bind(h),l=NGY2Tools.NanoAlert,m=NGY2Tools.GetImageTitleFromURL.bind(h),n=NGY2Tools.FilterAlbumName.bind(h),o=NGY2Tools.AlbumPostProcess.bind(h);switch(b){case"GetHiddenAlbums":j(arguments[2],arguments[3]);break;case"AlbumGetContent":i(arguments[2],arguments[3],arguments[4],arguments[5]);break;case"Init":f()}}});