/* nanogallery2 - v0.0.0 - 2017-05-01 - http://nanogallery2.nanostudio.org */
/**!
 * @preserve nanogallery2 - FLICKR data provider
 * Homepage: http://nanogallery2.nanostudio.org
 * Sources:  https://github.com/nanostudio-org/nanogallery2
 *
 * License:  GPLv3 and commercial licence
 * 
*/
!function(a){jQuery.nanogallery2.data_flickr=function(a,b){function c(a,b){var c=h.I[a].GetID();jQuery.each(b,function(a,b){for(var d=b.title,f=b.id,g=b.description._content,i=b.url_sq,a=j.photoSize;a>=0;a--)if(void 0!=b["url_"+j.photoAvailableSizesStr[a]]){i=b["url_"+j.photoAvailableSizesStr[a]];break}var k={};for(var l in b)0!=l.indexOf("height_")&&0!=l.indexOf("width_")&&0!=l.indexOf("url_")||(k[l]=b[l]);""!=h.O.thumbnailLabel.get("title")&&(d=o(i)),tags="",void 0!==b.tags&&(tags=b.tags);var m=NGY2Item.New(h,d,g,f,c,"image",tags);m.src=i,void 0!==b.url_o?(m.imageWidth=b.width_o,m.imageHeight=b.height_o):(m.imageWidth=b.width_z,m.imageHeight=b.height_z);var n={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};n=e(n,b,"l1"),n=e(n,b,"lN"),m.thumbs=n}),h.I[a].contentIsLoaded=!0}function d(a,b){var c=h.I[a].GetID();jQuery.each(b,function(a,b){if(itemTitle=b.title._content,p(itemTitle,b.id)){itemID=b.id,itemDescription="",void 0!=b.description._content&&(itemDescription=b.description._content);var d={};for(var f in b.primary_photo_extras)d[f]=b.primary_photo_extras[f];tags="",void 0!==b.primary_photo_extras&&void 0!==b.primary_photo_extras.tags&&(tags=b.primary_photo_extras.tags);var g=NGY2Item.New(h,itemTitle,itemDescription,itemID,c,"album",tags);g.numberItems=b.photos,g.thumbSizes=d;var i={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};i=e(i,b.primary_photo_extras,"l1"),i=e(i,b.primary_photo_extras,"lN"),g.thumbs=i}}),h.I[a].contentIsLoaded=!0}function e(a,b,c){var d=1;!0===h.tn.opt[c].crop&&(d=h.O.thumbnailCropScaleFactor);for(var e=["xs","sm","me","la","xl"],g=0;g<e.length;g++)if("auto"==h.tn.settings.width[c][e[g]]||""==h.tn.settings.width[c][e[g]]){var i="height_",j=Math.ceil(h.tn.settings.height[c][e[g]]*h.tn.scale*d),k=f(i,j,b);a.url[c][e[g]]=k.url,a.width[c][e[g]]=k.width,a.height[c][e[g]]=k.height}else if("auto"==h.tn.settings.height[c][e[g]]||""==h.tn.settings.height[c][e[g]]){var i="width_",j=Math.ceil(h.tn.settings.width[c][e[g]]*h.tn.scale*d),k=f(i,j,b);a.url[c][e[g]]=k.url,a.width[c][e[g]]=k.width,a.height[c][e[g]]=k.height}else{var i="height_",j=Math.ceil(h.tn.settings.height[c][e[g]]*h.tn.scale*d);h.tn.settings.width[c][e[g]]>h.tn.settings.height[c][e[g]]&&(i="width_",j=Math.ceil(h.tn.settings.width[c][e[g]]*h.tn.scale*d));var k=f(i,j,b);a.url[c][e[g]]=k.url,a.width[c][e[g]]=k.width,a.height[c][e[g]]=k.height}return a}function f(a,b,c){for(var d={url:"",width:0,height:0},e=0,f=0;f<j.thumbAvailableSizes.length;f++){var g=c[a+j.photoAvailableSizesStr[f]];if(void 0!=g&&(e=f,g>=b))break}var h=j.photoAvailableSizesStr[e];return d.url=c["url_"+h],d.width=parseInt(c["width_"+h]),d.height=parseInt(c["height_"+h]),d}function g(){}var h=a,j={url:function(){return"https://api.flickr.com/services/rest/"},thumbSize:"sq",thumbAvailableSizes:new Array(75,100,150,240,500,640),thumbAvailableSizesStr:new Array("sq","t","q","s","m","z"),photoSize:"0",photoAvailableSizes:new Array(75,100,150,240,500,640,1024,1024,1600,2048),photoAvailableSizesStr:new Array("sq","t","q","s","m","z","b","l","h","k"),ApiKey:"2f0e634b471fdb47446abcb9c5afebdc"},k=function(a,b,e,f){var g=NGY2Item.GetIdx(h,a),i="",k="image";"NONE"==h.O.photoset.toUpperCase()||"NONE"==h.O.album.toUpperCase()?i=j.url()+"?&method=flickr.people.getPublicPhotos&api_key="+j.ApiKey+"&user_id="+h.O.userID+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_z,url_b,url_h,url_k&per_page=500&format=json":0==h.I[g].GetID()?(i=j.url()+"?&method=flickr.photosets.getList&api_key="+j.ApiKey+"&user_id="+h.O.userID+"&per_page=500&primary_photo_extras=tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",k="album"):i=j.url()+"?&method=flickr.photosets.getPhotos&api_key="+j.ApiKey+"&photoset_id="+h.I[g].GetID()+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",m(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var l=setTimeout(function(){m(!1),n(h,"Could not retrieve AJAX data...")},6e4),o=[],p=function(){clearTimeout(l),m(!1),"album"==k?d(g,o):c(g,o),q(a),null!==b&&void 0!==b&&b(e,f,null)},r=function(a,b){jQuery.getJSON(a+"&page="+b+"&jsoncallback=?",function(c,d,e){var f=0;if("album"==k){if(void 0!==c.stat&&"fail"===c.stat)return n(h,"Could not retrieve Flickr album list: "+c.message+" (code: "+c.code+")."),!1;o=o.concat(c.photosets.photoset),f=c.photosets.pages}else if("NONE"==h.O.photoset.toUpperCase()||"NONE"==h.O.album.toUpperCase())o=o.concat(c.photos.photo),f=c.photos.pages;else{if(void 0!==c.stat&&"fail"===c.stat)return n(h,"Could not retrieve Flickr album: "+c.message+" (code: "+c.code+")."),!1;""==h.I[g].title&&(h.I[g].title=c.photoset.title),o=o.concat(c.photoset.photo),f=c.photoset.pages}f>b?r(a,b+1):p()}).fail(function(a,b,c){clearTimeout(l),m(!1),n(h,"Could not retrieve Flickr ajax data: "+b+", "+c)})};r(i,1)},l=function(a,b){b()},m=NGY2Tools.PreloaderDisplay.bind(h),n=NGY2Tools.NanoAlert,o=NGY2Tools.GetImageTitleFromURL.bind(h),p=NGY2Tools.FilterAlbumName.bind(h),q=NGY2Tools.AlbumPostProcess.bind(h),r=Math.max(window.screen.width,window.screen.height);for(void 0!=window.devicePixelRatio&&window.devicePixelRatio>1&&(r*=window.devicePixelRatio),h.O.flickrSkipOriginal||(j.photoAvailableSizes.push(1e4),j.photoAvailableSizesStr.push("o")),i=0;i<j.photoAvailableSizes.length&&(j.photoSize=i,!(r<=j.photoAvailableSizes[i]));i++);switch(b){case"GetHiddenAlbums":var s=arguments[2],t=arguments[3];l(s,t);break;case"AlbumGetContent":var u=arguments[2],t=arguments[3];k(u,t,arguments[4],arguments[5]);break;case"Init":g()}}}(jQuery);